<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DAMAC Truck Locator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
  #mapContainer { height: 60vh; width: 100%; }
  iframe { width: 100%; height: 100%; border: 0; }
  .controls { padding: 10px; max-width: 400px; margin: 10px auto; }
  select, input, button { width: 100%; padding: 8px; margin: 5px 0; }
  #output { font-weight: bold; margin-top: 10px; }
</style>
</head>
<body>

<h1 style="text-align:center;">DAMAC Truck Locator</h1>

<div id="mapContainer">
  <!-- Embed the CreationFMS locator with your token -->
  <iframe src="https://gps.creationfms.net/locator/index.html?t=d2cb4c3698b2dce9f7f1d85d9c3ff7be23CF883AF11190FC76D99E117B71101E10B464B2" allowfullscreen></iframe>
</div>

<div class="controls">
  <label for="siteLat">Site Latitude</label>
  <input type="number" id="siteLat" placeholder="Enter site latitude">
  
  <label for="siteLon">Site Longitude</label>
  <input type="number" id="siteLon" placeholder="Enter site longitude">
  
  <label for="truckSelect">Select Truck</label>
  <select id="truckSelect">
    <option value="">Enter truck name manually (live list in iframe)</option>
  </select>
  
  <button onclick="calculateDistance()">Calculate Distance & ETA</button>
  <p id="output"></p>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ====== Haversine distance formula ======
function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371; // km
  const dLat = (lat2 - lat1) * Math.PI/180;
  const dLon = (lon2 - lon1) * Math.PI/180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

// ====== Calculate Distance & ETA ======
function calculateDistance() {
  const siteLat = parseFloat(document.getElementById("siteLat").value);
  const siteLon = parseFloat(document.getElementById("siteLon").value);
  const truckLat = parseFloat(prompt("Enter truck latitude from iframe map:"));
  const truckLon = parseFloat(prompt("Enter truck longitude from iframe map:"));
  const speed = parseFloat(prompt("Enter truck speed in km/h (default 40):") || 40);
  
  if(!siteLat || !siteLon || !truckLat || !truckLon){
    alert("Please enter all coordinates");
    return;
  }
  
  const distance = haversine(truckLat, truckLon, siteLat, siteLon).toFixed(2);
  const eta = (distance / speed).toFixed(2);
  
  document.getElementById("output").innerText = `Distance: ${distance} km | ETA: ${eta} hours`;
}
</script>

</body>
</html>
